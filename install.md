# Win10 多用户远程桌面登录设置

## 简介

Win10 默认不支持多用户同时登录，需要借助软件修改 RDP 功能，Win10 普通版和 LTSC 2021 版本均适用。

参考链接：[How to Allow Multiple RDP Sessions in Windows 10 and 11? | Windows OS Hub](https://www.windowsoshub.com/)

## 前置条件

- 下载 [RDPWrap](https://github.com/stascorp/rdpwrap/releases)
- 下载最新配置文件：`rdpwrap.ini`

## 具体操作

### 1. 配置组策略

1. 快捷键 `Win+R` 打开运行，输入 `gpedit.msc` 打开本地组策略编辑器。
2. 依次点开：`本地计算机策略` > `计算机配置` > `管理模板` > `Windows 组件` > `远程桌面服务` > `远程桌面会话主机` > `连接`
3. 查看右侧设置项，修改以下 3 个配置：

   - **开启 允许用户通过使用远程桌面服务进行远程连接**

   - **开启 限制连接的数量，并设置最大连接数**（根据需求设置即可）

   - **开启 将远程桌面服务用户限制到单独的远程桌面服务会话**（重要选项，用来保持用户程序的后台运行）

4. 修改完成后，需要刷新组策略，右键管理员打开 `cmd` 或 `powershell`，输入 `gpupdate /force` 刷新完成后即可关闭命令行。

### 2. 安装 RDPWrap

1. 打开下载的 RDPWrap 文件夹，右键管理员运行 `install.bat`
2. 双击运行 `RDPConf.exe`

   ![RDPConf.exe](2023-01-08_16-34-28.png)

3. 查看右上角，如果显示红色的 `[not supported]`，先关闭 `RDPConf.exe`，再用下载的 `rdpwrap.ini` 覆盖 `C:\Program Files\RDP Wrapper\rdpwrap.ini`。
4. 不用重启电脑，重新运行 `RDPConf.exe`，此时右上角应该显示绿色的 `[fully supported]`。
   
至此，多用户登录设置已经完成。如果本地账户只有一个，继续参考后续内容添加用户即可。

### 3. 添加用户并配置远程登录权限

1. 右键点击桌面左下角 `Win` 标志，点击打开 `计算机管理`。
2. 依次打开：`系统工具` > `本地用户和组` > `用户`。
3. 右键点击用户，选择 `新用户`，根据需求创建新用户，完成后即可关闭计算机管理。
4. 回到桌面，依次打开：`系统设置` > `系统` > `远程桌面` > 选择可远程访问这台电脑的用户。

   ![远程桌面配置](2023-01-08_16-51-50.png)

5. 依次打开：`添加` > `高级` > `立即查找`，在下方搜索结果中找到新添加的用户，依次确定即可。

   ![用户添加](2023-01-08_16-58-19.png)

## 总结

部分系统版本可能完成这些操作后，依然无法同时登录多个用户。可以尝试重启电脑，不推荐直接覆盖 `C:\Windows\System32\termsrv.dll`。
